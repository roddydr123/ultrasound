from slice_thickness import extract_Ls_new
import numpy as np
from slice_thickness import extract_Ls_new
from resolution_integral import calc_R
import pytest


def test_extract_Ls():
    videos = ["/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid50.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid51.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid56.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid57.txt"]

    inv_diameters = np.linspace(0.01, 1.7, 400)

    pipe_diameters = 1 / inv_diameters

    L_dict, lengths, diameters = extract_Ls_new(videos, pipe_diameters, 20, 3)

    assert L_dict == {0.5882352941176471: 0, 0.5897045565392176: 0, 0.5911811770283886: 0, 0.5926652109977274: 0, 0.5941567144176072: 0, 0.595655743823244: 0, 0.5971623563218391: 0, 0.5986766095998319: 0, 0.6001985619302627: 0, 0.6017282721802469: 0, 0.6032657998185668: 0, 0.6048112049233755: 0, 0.6063645481900246: 0, 0.6079258909390093: 0, 0.6094952951240377: 0, 0.6110728233402252: 0, 0.6126585388324172: 0, 0.6142525055036409: 0, 0.6158547879236895: 0, 0.6174654513378418: 0, 0.6190845616757176: 0, 0.6207121855602744: 0, 0.6223483903169453: 0, 0.6239932439829223: 0, 0.6256468153165867: 0, 0.6273091738070906: 0, 0.6289803896840911: 0, 0.63066053392764: 0, 0.6323496782782339: 0, 0.6340478952470244: 0, 0.635755258126195: 0, 0.6374718409995047: 0, 0.6391977187530038: 0, 0.6409329670859236: 0, 0.6426776625217447: 0, 0.644431882419446: 0, 0.6461957049849383: 0, 0.6479692092826868: 0, 0.6497524752475248: 0, 0.6515455836966639: 0, 0.6533486163419027: 0, 0.6551616558020393: 0, 0.656984785615491: 0, 0.6588180902531249: 0, 0.6606616551313045: 0, 0.6625155666251556: 0, 0.6643799120820567: 0, 0.6662547798353565: 0, 0.6681402592183262: 0, 0.6700364405783472: 0, 0.6719434152913439: 0, 0.6738612757764605: 0, 0.6757901155109921: 0, 0.6777300290455727: 0, 0.6796811120196239: 0, 0.6816434611770735: 0, 0.6836171743823459: 0, 0.6856023506366308: 0, 0.6875990900944371: 0, 0.689607494080437: 0, 0.6916276651066043: 0, 0.6936597068896577: 0, 0.6957037243688101: 0, 0.6977598237238339: 0, 0.6998281123934471: 0, 0.7019086990940276: 0, 0.7040016938386618: 0, 0.7061072079565364: 0, 0.7082253541126771: 0, 0.7103562463280456: 0, 0.7125: 0, 0.7146567319231252: 0, 0.7168265603104452: 0, 0.7190096048150217: 0, 0.7212059865519485: 0, 0.7234158281207507: 0, 0.7256392536281963: 0, 0.7278763887115312: 0, 0.7301273605621431: 0, 0.7323922979496686: 0, 0.7346713312465475: 0, 0.7369645924530394: 0, 0.7392722152227081: 0, 0.7415943348883891: 0, 0.7439310884886452: 0, 0.7462826147947255: 0, 0.7486490543380366: 0, 0.7510305494381389: 0, 0.7534272442312776: 0, 0.7558392846994639: 0, 0.758266818700114: 0, 0.7607099959962631: 0, 0.7631689682873647: 0, 0.7656438892406885: 0, 0.7681349145233328: 0, 0.7706422018348623: 0, 0.7731659109405883: 0, 0.7757062037055039: 0, 0.7782632441288914: 0, 0.7808371983796161: 0, 0.7834282348321225: 0, 0.7860365241031501: 0, 0.788662239089184: 0, 0.7913055550046606: 0, 0.7939666494209416: 0, 0.7966457023060797: 0, 0.7993428960653898: 0, 0.8020584155828492: 0, 0.8047924482633426: 0, 0.8075451840757757: 0, 0.8103168155970756: 0, 0.8131075380571009: 0, 0.8159175493844832: 0, 0.8187470502534216: 0, 0.8215962441314555: 0, 0.8244653373282363: 0, 0.8273545390453282: 0, 0.8302640614270553: 0, 0.833194119612429: 0, 0.8361449317881767: 0, 0.8391167192429022: 0, 0.8421097064224056: 0, 0.8451241209861899: 0, 0.8481601938651872: 0, 0.8512181593207322: 0, 0.8542982550048175: 0, 0.8574007220216606: 0, 0.8605258049906183: 0, 0.8636737521104809: 0, 0.8668448152251841: 0, 0.8700392498909726: 0, 0.8732573154450548: 0, 0.8764992750757875: 0, 0.8797653958944281: 0, 0.8830559490084985: 0, 0.8863712095968012: 0, 0.8897114569861303: 0, 0.8930769747297267: 0, 0.8964680506875168: 0, 0.8998849771081892: 0, 0.9033280507131536: 0, 0.9067975727824368: 0, 0.9102938492425625: 0, 0.9138171907564757: 0, 0.9173679128155607: 0, 0.9209463358338141: 0, 0.9245527852442303: 0, 0.9281875915974598: 0, 0.9318510906628054: 0, 0.9355436235316186: 0, 0.9392655367231638: 0, 0.9430171822930207: 0, 0.9467989179440939: 0, 0.9506111071403045: 0, 0.9544541192230408: 0, 0.9583283295304431: 0, 0.9622341195196064: 0, 0.966171876891784: 0, 0.9701419957206769: 0, 0.974144876583901: 0, 0.9781809266977199: 0, 0.9822505600551438: 0, 0.9863541975674873: 0, 0.9904922672094929: 0, 0.9946652041681209: 0, 0.9988734509951183: 0, 1.0031174577634754: 0, 1.007397682227889: 0, 1.0117145899893503: 0, 1.0160686546639843: 0, 1.020460358056266: 0, 1.0248901903367496: 0, 1.0293586502244467: 0, 1.0338662451739953: 0, 1.03841349156777: 0, 1.0430009149130832: 0, 1.0476290500446357: 0, 1.052298441332384: 0, 1.0570096428949878: 0, 1.0617632188190211: 0, 1.0665597433841218: 0, 1.0713998012942725: 0, 1.0762839879154078: 0, 1.0812129095195513: 0, 1.0861871835356889: 0, 1.0912074388076027: 0, 1.0962743158588857: 0, 1.1013884671653738: 0, 1.1065505574352432: 0, 1.1117612638970158: 0, 1.1170212765957446: 0, 1.1223312986976457: 0, 1.1276920468034595: 0, 1.1331042512708374: 0, 1.1385686565460564: 0, 1.1440860215053763: 0, 1.1496571198063734: 0, 1.1552827402495873: 0, 1.160963687150838: 0, 1.1667007807245826: 0, 1.1724948574786953: 0, 1.1783467706210684: 0, 1.184257390478452: 0, 1.1902276049279599: 0, 1.196258319841698: 0, 1.2023504595449752: 0, 1.2085049672885873: 0, 1.2147228057356836: 0, 1.2210049574637372: 0, 1.2273524254821742: 0, 1.2337662337662338: 0, 1.2402474278076527: 0, 1.246797075182801: 0, 1.2534162661389125: 0, 1.2601061141990904: 0, 1.2668677567867914: 0, 1.273702355870523: 0, 1.2806110986295214: 0, 1.287595198141216: 0, 1.2946558940913073: 0, 1.301794453507341: 0, 1.3090121715166825: 0, 1.3163103721298495: 0, 1.323690409050194: 0, 1.3311536665109762: 0, 1.338701560140916: 0, 1.3463355378593602: 0, 1.3540570808022534: 0, 1.3618677042801557: 0, 1.3697689587696111: 0, 1.3777624309392265: 0, 1.3858497447118892: 0, 1.3940325623646146: 0, 1.4023125856675922: 0, 1.4106915570640643: 0, 1.4191712608927618: 0, 1.427753524654691: 0, 1.4364402203261692: 0, 1.445233265720081: 0, 1.4541346258974452: 0, 1.4631463146314632: 0, 1.4722703959263497: 0, 1.481508985593346: 0, 1.4908642528864477: 0, 1.5003384222004963: 0, 1.509933774834437: 0, 1.519652650822669: 0, 1.5294974508375818: 0, 1.5394706381665253: 0, 1.5495747407666318: 0, 1.5598123534010946: 0, 1.5701861398606902: 0, 1.5806988352745424: 0, 1.591353248514338: 0, 1.6021522646964343: 0, 1.6130988477865373: 0, 1.6241960433118943: 0, 1.6354469811862113: 0, 1.6468548786527983: 0, 1.6584230433517604: 0, 1.6701548765173713: 0, 1.6820538763121284: 0, 1.694123641304348: -3.1649831649831697, 1.7063678740965658: -2.658585858585866, 1.718790385112432: -1.6246913580246982, 1.7313950965502278: -0.8228956228956221, 1.744186046511628: -0.8228956228956221, 1.757167393314837: -0.5696969696969703, 1.7703434200017747: -0.5696969696969703, 1.7837185390495773: 1.6035914702581309, 1.7972972972972974: 7.9215007215007205, 1.81108438109936: 36.58720538720538, 1.8250846217180494: 13.292929292929294, 1.8393030009680542: 13.292929292929294, 1.853744657126928: 13.672727272727272, 1.8684148911261997: 13.925925925925924, 1.8833191730387993: 14.115824915824916, 1.8984631488794783: 14.242424242424242, 1.913852647735994: 14.62222222222222, 1.9294936892499637: 15.065319865319864, 1.9453924914675766: 15.318518518518516, 1.9615554790816578: 15.635016835016835, 1.9779892920880429: 15.888215488215486, 1.994700794880768: 15.888215488215486, 2.0116970858122416: 16.078114478114475, 2.0289855072463765: 16.078114478114475, 2.0465736561345915: 16.457912457912457, 2.064469395146686: 16.457912457912457, 2.0826808643908548: 16.77441077441077, 2.101216493759545: 16.77441077441077, 2.120085015940489: 17.027609427609423, 2.1392954801351136: 17.027609427609423, 2.1588572665295964: 17.34410774410774, 2.1787801015671926: 17.34410774410774, 2.199074074074074: 17.660606060606057, 2.219749652294854: 17.660606060606057, 2.2408177018982363: 17.660606060606057, 2.26228950501786: 17.977104377104375, 2.2841767803984427: 18.230303030303027, 2.3064917047228164: 18.230303030303027, 2.3292469352014007: 18.736700336700334, 2.352455633512175: 18.736700336700334, 2.376131491186279: 18.926599326599323, 2.4002887565421407: 18.926599326599323, 2.4249422632794455: 19.3063973063973, 2.450107460853546: 19.3063973063973, 2.475800446760983: 19.87609427609427, 2.5020380008779077: 19.87609427609427, 2.528837622005324: 20.255892255892253, 2.556217566788391: 20.255892255892253, 2.5841968911917097: 20.509090909090908, 2.6127954947285703: 20.509090909090908, 2.6420341676599124: 20.888888888888886, 2.6719346413982454: 20.888888888888886, 2.702519642373341: 21.458585858585856, 2.7338129496402876: 21.458585858585856, 2.7658394565368085: 21.458585858585856, 2.798625236725819: 21.96498316498316, 2.832197614991482: 21.96498316498316, 2.866585243192758: 22.344781144781138, 2.901818181818182: 22.344781144781138, 2.937927987629777: 22.85117845117845, 2.974947807933194: 23.23097643097643, 3.012912482065997: 24.1278461966489, 3.051858650757228: 28.597357498537935, 3.091824874079814: 28.977795947104543, 3.1328517587939695: 30.308369813934732, 3.1749820959656243: 31.164356323209596, 3.2182610098402966: 33.19250742387336, 3.262736119061248: 34.61915160599814, 3.3084577114427858: 36.172074880337945, 3.355478933647296: 37.94670709341872, 3.4038559972700906: 38.802693602693594, 3.4536484030122048: 41.62353154933256, 3.504919184820801: 42.57462767074908, 3.557735176103433: 44.57064858818653, 3.612167300380228: 45.23641587317809, 3.6682908890319017: 47.042217566332226, 3.7261860291370934: 48.37375213631537, 3.785937944776544: 49.16611874790627, 3.847637415621987: 50.402543705747746, 3.9113812371336145: 53.15880105154977, 3.977272727272727: 54.933753499014884, 4.04542228530873: 58.387908313034785, 4.11594800907778: 67.5499207930911, 4.188976377952756: 67.86641910958942, 4.264643009833262: 72.43104002362011, 4.343093501687167: 73.5071342997144, 4.424484364604125: 74.83642722900733, 4.508984065996158: 75.59602318860328, 4.596774193548387: 79.0142050067851, 4.688050757842792: 79.0142050067851, 4.783025653320546: 79.0142050067851, 4.881928300501651: 79.13119730185497, 4.985007496251874: 79.13119730185497, 5.092533503509891: 79.13119730185497, 5.204800417427602: 79.13119730185497, 5.322128851540616: 79.13119730185497, 5.444868995633188: 79.13119730185497, 5.573404106718815: 79.13119730185497, 5.708154506437769: 79.13119730185497, 5.8495821727019495: 79.13119730185497, 5.998196031268791: 79.13119730185497, 6.154558074965293: 79.13119730185497, 6.319290465631929: 79.13119730185497, 6.493083807973962: 79.13119730185497, 6.676706827309237: 79.13119730185497, 6.871017737213707: 79.13119730185497, 7.07697765164952: 79.13119730185497, 7.295666483817882: 79.13119730185497, 7.528301886792454: 79.13119730185497, 7.776261937244201: 79.13119730185497, 8.041112454655382: 79.13119730185497, 8.324640100146047: 79.13119730185497, 8.628892733564015: 79.13119730185497, 8.956228956228957: 79.13119730185497, 9.309379374708353: 79.13119730185497, 9.691522953606995: 79.13119730185497, 10.106382978723405: 79.13119730185497, 10.558348769515746: 79.13119730185497, 11.052631578947368: 79.13119730185497, 11.595466434176112: 79.13119730185497, 12.19437652811736: 79.13119730185497, 12.858524009023526: 79.13119730185497, 13.59918200408998: 79.13119730185497, 14.430379746835444: 79.13119730185497, 15.369799691833592: 79.13119730185497, 16.440049443757726: 79.13119730185497, 17.670504871567758: 79.13119730185497, 19.10004786979416: 79.13119730185497, 20.78125: 79.13119730185497, 22.786978869217588: 79.13119730185497, 25.221238938053098: 79.13119730185497, 28.237791932059448: 79.13119730185497, 32.07395498392283: 79.13119730185497, 37.116279069767444: 79.13119730185497, 44.039735099337754: 79.13119730185497, 54.13839891451832: 79.13119730185497, 70.24647887323944: 79.13119730185497, 100.0: 79.13119730185497}
    assert lengths == [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -3.1649831649831697, -2.658585858585866, -1.6246913580246982, -0.8228956228956221, -0.8228956228956221, -0.5696969696969703, -0.5696969696969703, 1.6035914702581309, 7.9215007215007205, 36.58720538720538, 13.292929292929294, 13.292929292929294, 13.672727272727272, 13.925925925925924, 14.115824915824916, 14.242424242424242, 14.62222222222222, 15.065319865319864, 15.318518518518516, 15.635016835016835, 15.888215488215486, 15.888215488215486, 16.078114478114475, 16.078114478114475, 16.457912457912457, 16.457912457912457, 16.77441077441077, 16.77441077441077, 17.027609427609423, 17.027609427609423, 17.34410774410774, 17.34410774410774, 17.660606060606057, 17.660606060606057, 17.660606060606057, 17.977104377104375, 18.230303030303027, 18.230303030303027, 18.736700336700334, 18.736700336700334, 18.926599326599323, 18.926599326599323, 19.3063973063973, 19.3063973063973, 19.87609427609427, 19.87609427609427, 20.255892255892253, 20.255892255892253, 20.509090909090908, 20.509090909090908, 20.888888888888886, 20.888888888888886, 21.458585858585856, 21.458585858585856, 21.458585858585856, 21.96498316498316, 21.96498316498316, 22.344781144781138, 22.344781144781138, 22.85117845117845, 23.23097643097643, 24.1278461966489, 28.597357498537935, 28.977795947104543, 30.308369813934732, 31.164356323209596, 33.19250742387336, 34.61915160599814, 36.172074880337945, 37.94670709341872, 38.802693602693594, 41.62353154933256, 42.57462767074908, 44.57064858818653, 45.23641587317809, 47.042217566332226, 48.37375213631537, 49.16611874790627, 50.402543705747746, 53.15880105154977, 54.933753499014884, 58.387908313034785, 67.5499207930911, 67.86641910958942, 72.43104002362011, 73.5071342997144, 74.83642722900733, 75.59602318860328, 79.0142050067851, 79.0142050067851, 79.0142050067851, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497, 79.13119730185497]



def test_calc_R():
    videos = ["/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid50.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid51.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid56.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid57.txt"]

    inv_diameters = np.linspace(0.01, 1.7, 400)

    pipe_diameters = 1 / inv_diameters

    L_dict, lengths, diameters = extract_Ls_new(videos, pipe_diameters, 20, 3)

    inverse_diameters = 1 / diameters

    lengths = np.array(lengths)

    assert calc_R(lengths, inverse_diameters, show=False) == (2.679, 72.23, 26.96)


videos = ["/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid50.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid51.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid56.txt",
            "/home/david/Documents/uni/5th-year/ultrasound/scripts/analysed/gen3/vid57.txt"]

inv_diameters = np.linspace(0.01, 1.7, 400)

pipe_diameters = 1 / inv_diameters

L_dict, lengths, diameters = extract_Ls_new(videos, pipe_diameters, 20, 3)
print(diameters)